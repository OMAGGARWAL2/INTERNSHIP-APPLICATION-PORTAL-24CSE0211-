<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Course - InternHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root { --cream:#f6f1e7; --blue:#1e3a8a; --sea:#0ea5e9; --border: rgba(30,58,138,.15); }
        body { font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: var(--cream); color: var(--blue); margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
        .btn { padding: .8rem 1.2rem; border: none; border-radius: 10px; color: #fff; background: linear-gradient(135deg, var(--blue), var(--sea)); cursor: pointer; font-weight: 600; }
        .btn.secondary { background: transparent; color: var(--sea); border: 2px solid var(--sea); }
        .card { background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem; }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        label { display:block; font-weight:600; margin-bottom:.35rem; }
        input, select, textarea { width: 100%; padding: .9rem; border: 2px solid var(--border); border-radius: 10px; font: inherit; background: #fff; color: var(--blue); }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--sea); box-shadow: 0 0 0 3px rgba(14,165,233,.15); }
        .module { position: relative; }
        .module::before { content:""; position:absolute; left:0; top:0; bottom:0; width:4px; background: var(--sea); border-radius: 12px 0 0 12px; }
        .module-actions { display:flex; gap:.5rem; }
        .hint { font-size:.9rem; color: rgba(30,58,138,.8); }
        .grid-3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap: .75rem; }
        .muted { color: rgba(30,58,138,0.7); }
        @media (max-width: 768px){ .row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="d-flex" style="display:flex; align-items:center; gap:.75rem;">
                <a href="index.html" style="color:var(--blue); text-decoration:none;"><i class="fas fa-arrow-left"></i></a>
                <h2 style="margin:0">Create Course</h2>
            </div>
            <div>
                <button id="saveCourse" class="btn"><i class="fas fa-save"></i> Save Course</button>
            </div>
        </div>

        <div class="card">
            <div class="row">
                <div>
                    <label>Course Title *</label>
                    <input id="courseTitle" placeholder="e.g., Full Stack Web Development" required>
                </div>
                <div>
                    <label>Category</label>
                    <input id="courseCategory" placeholder="e.g., Web Development">
                </div>
            </div>
            <div style="margin-top:1rem;">
                <label>Course Description</label>
                <textarea id="courseDescription" rows="3" placeholder="Describe what learners will achieve..."></textarea>
            </div>
        </div>

    <div class="d-flex" style="display:flex; justify-content:space-between; align-items:center; margin:.5rem 0 1rem;">
            <h3 style="margin:0">Modules</h3>
            <button class="btn secondary" id="addModule"><i class="fas fa-plus"></i> Add Module</button>
        </div>
        <div id="modules"></div>

        <div class="card">
            <h3 style="margin-top:0">Publishing</h3>
            <div class="row">
                <div>
                    <label>Estimated Duration (hours)</label>
                    <input id="courseDuration" type="number" min="1" placeholder="e.g., 40">
                </div>
                <div>
                    <label>Level</label>
                    <select id="courseLevel">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>
            </div>
            <div style="margin-top:1rem; display:flex; gap:.75rem;">
                <button class="btn" id="publishCourse"><i class="fas fa-upload"></i> Publish</button>
                <span class="muted">Saved courses are stored locally on your device.</span>
            </div>
        </div>
    </div>

<script>
let moduleCount = 0;

function el(html){ const d=document.createElement('div'); d.innerHTML=html.trim(); return d.firstChild; }

function moduleTemplate(id){
  return `
  <div class="card module" data-id="${id}">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:.75rem;">
      <h4 style="margin:0; display:flex; align-items:center; gap:.5rem;"><span class="muted">Module</span> <span>#${id}</span></h4>
      <div class="module-actions">
        <button class="btn secondary" onclick="addLesson(${id})"><i class='fas fa-plus'></i> Add Lesson</button>
        <button class="btn secondary" onclick="removeModule(${id})" title="Remove"><i class="fas fa-trash"></i></button>
      </div>
    </div>
    <div class="row" style="margin-top:1rem;">
      <div>
        <label>Module Title *</label>
        <input class="module-title" placeholder="e.g., HTML & Semantic Markup">
      </div>
      <div>
        <label>Module Type *</label>
        <select class="module-type">
          <option value="video">Video</option>
          <option value="reading">Reading</option>
          <option value="assignment">Assignment (Graded)</option>
          <option value="quiz">Quiz (Graded)</option>
        </select>
      </div>
    </div>
    <div class="module-config" style="margin-top:1rem;"></div>
    <div class="lessons" style="margin-top:1rem;"></div>
  </div>`;
}

function lessonTemplate(){
  return `
  <div class="card" style="margin-top:.5rem;">
    <div class="row">
      <div>
        <label>Lesson Title *</label>
        <input class="lesson-title" placeholder="e.g., Intro to HTML">
      </div>
      <div>
        <label>Content Type</label>
        <select class="lesson-type">
          <option value="video">Video URL</option>
          <option value="article">Article URL</option>
          <option value="text">Rich Text</option>
        </select>
      </div>
    </div>
    <div style="margin-top:.5rem;">
      <label>Content</label>
      <textarea class="lesson-content" rows="2" placeholder="Link or text content..."></textarea>
    </div>
  </div>`;
}

document.getElementById('addModule').onclick = () => {
  moduleCount += 1;
  const m = el(moduleTemplate(moduleCount));
  // Render initial config for default type
  renderModuleConfig(m);
  m.querySelector('.module-type').addEventListener('change', () => renderModuleConfig(m));
  document.getElementById('modules').appendChild(m);
};

window.addLesson = function(moduleId){
  const container = document.querySelector(`.module[data-id="${moduleId}"] .lessons`);
  if (container) container.appendChild(el(lessonTemplate()));
}

window.removeModule = function(moduleId){
  const node = document.querySelector(`.module[data-id="${moduleId}"]`);
  if (node) node.remove();
}

function collectCourse(){
  const title = document.getElementById('courseTitle').value.trim();
  if (!title) { alert('Please add a course title.'); return null; }
  const course = {
    id: Date.now(),
    title,
    category: document.getElementById('courseCategory').value.trim(),
    description: document.getElementById('courseDescription').value.trim(),
    durationHours: parseInt(document.getElementById('courseDuration').value||'0')||0,
    level: document.getElementById('courseLevel').value,
    modules: []
  };
  document.querySelectorAll('.module').forEach(mod => {
    const type = mod.querySelector('.module-type').value;
    const moduleData = { title: mod.querySelector('.module-title').value.trim(), type };
    if (type === 'video') {
      moduleData.video = {
        fileName: mod.querySelector('.video-file')?.files?.[0]?.name || '',
        youtubeUrl: mod.querySelector('.video-youtube')?.value?.trim() || '',
        recording: mod.querySelector('.video-recording-url')?.value || '',
        description: mod.querySelector('.video-desc')?.value?.trim() || ''
      };
    } else if (type === 'reading') {
      moduleData.reading = {
        fileName: mod.querySelector('.reading-file')?.files?.[0]?.name || '',
        content: mod.querySelector('.reading-desc')?.value?.trim() || ''
      };
    } else if (type === 'assignment') {
      const mcqs = [];
      mod.querySelectorAll('.mcq-item').forEach(q => {
        mcqs.push({
          question: q.querySelector('.mcq-q')?.value?.trim() || '',
          options: {
            A: q.querySelector('.mcq-a')?.value?.trim() || '',
            B: q.querySelector('.mcq-b')?.value?.trim() || '',
            C: q.querySelector('.mcq-c')?.value?.trim() || '',
            D: q.querySelector('.mcq-d')?.value?.trim() || ''
          },
          correct: q.querySelector('.mcq-correct')?.value || 'A',
          weight: parseFloat(q.querySelector('.mcq-weight')?.value || '0')
        });
      });
      const codings = [];
      mod.querySelectorAll('.code-item').forEach(c => {
        const tests = [];
        c.querySelectorAll('.code-test').forEach(t => {
          tests.push({
            input: t.querySelector('.test-in')?.value || '',
            output: t.querySelector('.test-out')?.value || '',
            weight: parseFloat(t.querySelector('.test-weight')?.value || '0')
          });
        });
        codings.push({
          problem: c.querySelector('.code-problem')?.value?.trim() || '',
          tests
        });
      });
      moduleData.assignment = { mcqs, codings };
    }
    moduleData.lessons = [];
    mod.querySelectorAll('.lessons .card').forEach(lesson => {
      moduleData.lessons.push({
        title: lesson.querySelector('.lesson-title')?.value?.trim() || '',
        type: lesson.querySelector('.lesson-type')?.value || 'text',
        content: lesson.querySelector('.lesson-content')?.value?.trim() || ''
      });
    });
    course.modules.push(moduleData);
  });
  return course;
}

function saveCourse(course){
  const courses = JSON.parse(localStorage.getItem('courses')||'[]');
  courses.push(course);
  localStorage.setItem('courses', JSON.stringify(courses));
}

document.getElementById('saveCourse').onclick = () => {
  const c = collectCourse();
  if (!c) return;
  saveCourse(c);
  alert('Course saved locally.');
};

document.getElementById('publishCourse').onclick = () => {
  const c = collectCourse();
  if (!c) return;
  saveCourse(c);
  // Create a site notification
  const notifications = JSON.parse(localStorage.getItem('notifications')||'[]');
  notifications.unshift({ id: Date.now(), type:'course', title:'New Course Published', message:`${c.title} is now available.`, ts: new Date().toISOString() });
  localStorage.setItem('notifications', JSON.stringify(notifications));
  alert('Course published and notification created.');
};

// Rendering logic for module config
function renderModuleConfig(moduleEl){
  const type = moduleEl.querySelector('.module-type').value;
  const cfg = moduleEl.querySelector('.module-config');
  if (type === 'video') {
    cfg.innerHTML = `
      <div class="card">
        <div class="grid-3">
          <div>
            <label>Upload Video</label>
            <input type="file" class="video-file" accept="video/*">
            <div class="hint">Max size depends on your browser limits.</div>
          </div>
          <div>
            <label>YouTube Link</label>
            <input type="url" class="video-youtube" placeholder="https://www.youtube.com/watch?v=...">
          </div>
          <div>
            <label>Record</label>
            <div style="display:flex; gap:.5rem; align-items:center;">
              <button type="button" class="btn secondary btn-record-start">Start</button>
              <button type="button" class="btn secondary btn-record-stop">Stop</button>
            </div>
            <input type="hidden" class="video-recording-url">
          </div>
        </div>
        <div style="margin-top:.75rem;">
          <label>Video Description</label>
          <textarea class="video-desc" rows="3" placeholder="Describe this lecture..."></textarea>
        </div>
        <video class="video-preview" style="margin-top:.75rem; width:100%; max-height:300px; display:none;" controls></video>
      </div>
    `;
    attachRecordingHandlers(moduleEl);
  } else if (type === 'reading') {
    cfg.innerHTML = `
      <div class="card">
        <label>Upload Document (PDF/PPT)</label>
        <input type="file" class="reading-file" accept="application/pdf,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation">
        <div style="margin-top:.75rem;">
          <label>Reading Content / Notes</label>
          <textarea class="reading-desc" rows="4" placeholder="Write content or notes..."></textarea>
        </div>
      </div>
    `;
  } else if (type === 'assignment') {
    cfg.innerHTML = `
      <div class="card">
        <div style="display:flex; gap:.5rem; margin-bottom:.75rem;">
          <button type="button" class="btn secondary" onclick="addMcq(this)"><i class="fas fa-list"></i> Add MCQ</button>
          <button type="button" class="btn secondary" onclick="addCoding(this)"><i class="fas fa-code"></i> Add Coding</button>
        </div>
        <div class="assignments"></div>
      </div>
    `;
  } else {
    cfg.innerHTML = '';
  }
}

function addMcq(btn){
  const container = btn.closest('.card').querySelector('.assignments');
  const node = el(`
    <div class="card mcq-item" style="margin-top:.5rem;">
      <div class="row">
        <div>
          <label>Question</label>
          <input class="mcq-q" placeholder="Enter question">
        </div>
        <div>
          <label>Weight (%)</label>
          <input type="number" class="mcq-weight" min="0" max="100" value="10">
        </div>
      </div>
      <div class="row" style="margin-top:.5rem;">
        <div><label>Option A</label><input class="mcq-a"></div>
        <div><label>Option B</label><input class="mcq-b"></div>
      </div>
      <div class="row" style="margin-top:.5rem;">
        <div><label>Option C</label><input class="mcq-c"></div>
        <div><label>Option D</label><input class="mcq-d"></div>
      </div>
      <div style="margin-top:.5rem;">
        <label>Correct Option</label>
        <select class="mcq-correct"><option>A</option><option>B</option><option>C</option><option>D</option></select>
      </div>
      <div style="margin-top:.5rem; text-align:right;"><button type="button" class="btn secondary" onclick="this.closest('.mcq-item').remove()"><i class="fas fa-trash"></i> Remove</button></div>
    </div>
  `);
  container.appendChild(node);
}

function addCoding(btn){
  const container = btn.closest('.card').querySelector('.assignments');
  const node = el(`
    <div class="card code-item" style="margin-top:.5rem;">
      <label>Problem Statement</label>
      <textarea class="code-problem" rows="3" placeholder="Describe the coding task..."></textarea>
      <div style="margin-top:.5rem; display:flex; gap:.5rem; align-items:center;">
        <strong>Test Cases</strong>
        <button type="button" class="btn secondary" onclick="addTestCase(this)"><i class="fas fa-plus"></i> Add Test Case</button>
      </div>
      <div class="tests"></div>
      <div style="margin-top:.5rem; text-align:right;"><button type="button" class="btn secondary" onclick="this.closest('.code-item').remove()"><i class="fas fa-trash"></i> Remove</button></div>
    </div>
  `);
  container.appendChild(node);
}

function addTestCase(btn){
  const container = btn.closest('.code-item').querySelector('.tests');
  const node = el(`
    <div class="card code-test" style="margin-top:.5rem;">
      <div class="row">
        <div>
          <label>Input</label>
          <input class="test-in" placeholder="e.g., 2 3">
        </div>
        <div>
          <label>Expected Output</label>
          <input class="test-out" placeholder="e.g., 5">
        </div>
      </div>
      <div style="margin-top:.5rem; display:flex; gap:.5rem; align-items:center;">
        <div style="flex:1;">
          <label>Weight (%)</label>
          <input type="number" class="test-weight" min="0" max="100" value="10">
        </div>
        <button type="button" class="btn secondary" onclick="this.closest('.code-test').remove()"><i class="fas fa-trash"></i> Remove</button>
      </div>
    </div>
  `);
  container.appendChild(node);
}

// Simple MediaRecorder handling for video recording (if supported)
function attachRecordingHandlers(moduleEl){
  const startBtn = moduleEl.querySelector('.btn-record-start');
  const stopBtn = moduleEl.querySelector('.btn-record-stop');
  const preview = moduleEl.querySelector('.video-preview');
  const hiddenUrl = moduleEl.querySelector('.video-recording-url');
  if (!startBtn || !stopBtn) return;
  let mediaRecorder; let chunks=[]; let stream;
  startBtn.onclick = async () => {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      mediaRecorder = new MediaRecorder(stream);
      chunks = [];
      mediaRecorder.ondataavailable = (e)=>{ if (e.data.size>0) chunks.push(e.data); };
      mediaRecorder.onstop = ()=>{
        const blob = new Blob(chunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        hiddenUrl.value = url;
        preview.src = url; preview.style.display = 'block';
        stream.getTracks().forEach(t=>t.stop());
      };
      mediaRecorder.start();
      startBtn.disabled = true; stopBtn.disabled = false;
    } catch (e) {
      alert('Recording not supported or permission denied.');
    }
  };
  stopBtn.onclick = () => {
    try { mediaRecorder?.stop(); } catch(e){}
    startBtn.disabled = false; stopBtn.disabled = true;
  };
}
</script>
</body>
</html>

